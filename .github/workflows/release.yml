name: Release Zip

on:
  workflow_dispatch:
    inputs:
      tag:
        description: "Tag name to release (e.g., v1.0.0)"
        required: true

permissions:
  contents: write

jobs:
  release:
    runs-on: ubuntu-latest
    env:
      TAG_NAME: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.tag || github.ref_name }}
    steps:
      - name: Check out code
        uses: actions/checkout@v4

      - name: Create zip archive with top-level folder
        run: |
          echo "=== Current directory ==="
          pwd
          echo "=== Listing files ==="
          ls -la
          echo "=== Creating xmlui-weather folder ==="
          mkdir -p xmlui-weather
          echo "=== Copying files ==="
          cp -v -r Main.xmlui components index.html README.md xmlui-weather/
          echo "=== Contents of xmlui-weather ==="
          ls -la xmlui-weather/
          echo "=== Creating zip ==="
          zip -r xmlui-weather.zip xmlui-weather
          echo "=== Zip created ==="
          ls -lh xmlui-weather.zip

      - name: Publish release assets
        uses: softprops/action-gh-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ env.TAG_NAME }}
          target_commitish: ${{ github.sha }}
          files: xmlui-weather.zip
          body: |
            You can run it [online](https://playground.xmlui.org/#/playground/#H4sIAAAAAAAAE61Y227bOBD9lSmRjVvUl6RogYVrpUidpl2g2S3qbvNQBwUjTixuJFIgKTupoX%2FqN%2FTLFqRulOLE8WLzFJFnbmeGnKHXRBsqGI2lQDJeE5qmZEwmx2k6FwBLqoYhN7fBnMyoMBQ%2BS037MD2ek2pbI1VhNH0YhEpJdYZa0wUGc9JsGEzSvwU3wZycNqtcn3DlFK6vaKwxb7ZCKRg3XAq7CSukJkJ1Qg0dLmmc4TDMlEJhvte4bwcX4MkLpAq1%2BU4V0ntU%2BJCONNVGSSGT23tEy5VvBxcNtFRxNBdWy8SiZzJTIdpPAM6COfE0FcYAMhUHcxIZk%2BrxaLQyRg25GK0buvM3V1Il1AT%2FHFYyjuY%2FpeFXPKQ2%2BC7lAFK8s6BgTp469DMIjmANfoIggN5UZjEDIQ1cccGqSIFRQ%2BFKKujBc2hcgefQG8KnGKlGCCMMr8FECLZyQNAEh73XUOYUAnApfW05gVHFyvTrzNDwuvwEmHw4PCr%2BAzgvjZ9QHV1KqlgJGTlMhXfysERleEjj45gvRILCFlaIwqByGSgUTr7gjXkrb6rvMgnW3T9EmpmKK%2FuXxjTESMYMLWfvrCYvruHQx3LBDafxV1sKtkAsLvcBK85MFMzJ4SuFib8hxQln04gKl6unSxqXeXGmAljS2GfQqMwjsAzqbWaMFI3OmF6iLaH3aCoKfZMo6GWMrPJzaBRPnj4bxigWJoIjOMjbDk5jHl5b50rPvOwHzs3Xd4rooayXTn%2BmjMv3Smbp%2FTRWd0T%2BKMYqdMVa7iW%2BrhNvBWDyV2rPSk3Yr5%2BncwLL0vxpy%2BHN%2BKmHn3bwk1HH5GTUBH1Ul3Kn%2FG2FwipCd835vObOlOLUlTZDbVQWGr5EL8yOQGnCqmwMFOetkqgs%2BTcaF5%2BUXCjU2iM%2Bkor%2FkMJsO2GzlAuByk%2B1C6lxXaO9oqm6beXno6SMi0XrwrGnrOaujKL46F4a0%2B1RxZIyZLC%2Ff%2Ff2totPWjVsF8oK9ji4pOH1QslMsKmM3VW6F9p%2FBs3GoB1d7X7h3xYWYUHTYE4OOoX7olWEfiNoFZsPexznAGu%2F5Q0VLmx57%2B%2FDhmXbze7dKXl88%2FD2c%2Bj1oQdj6PXytuVQZsKo2xraiszL%2FIbc79gCdoZXZF5JYWb8hz3pL90l7lbOkS8iK3kpY9aRA1g3d1Jge2sP3kA9n7gR6PsUxt2l0%2FzXz5b9NgMbXXpRuLQ9455T%2Ba5G9qr%2FBzdxN36NCd%2FMQRNddfBQh5syvcGJO3fog6W92dd40fHpFDHWEPNr3JIgB%2FzIr7GdpHrZJmoTm3dK9sM9JeuHVXbqmaHGd7bqNdNYZgymctlu5lC3H4%2Fn0GJDC81%2F6zalLWY%2BZAln3NxutRGVwJ0tnNuxcpYisq02VlwwbZFnPEadQ5JGOxr7ZLtYpnCrqbQE5pBctgeV%2FyN5s0woru%2Fzon4wDHWBy3eMcpYJjeYx2jWaXZWfSfk455MS%2BF8MPMb9pMDlD6dnMrrzorCHsTsZPNk8GjzZOgdtvHh2HJKKxwRtnhNgJGhEKN%2Bw9RBU16feMMu1I52MjlM7VZI%2BCWWSSoHCaDL%2BRibT6tOZsifQy0fhVDU%2FlQPInk5piIPDOYGEi%2FPy7fK7azFHHqm73MLayq73UiVTPXSpz9szXd1sNrWUSrBoGZ6gT8JkVIdqibiwTIgrvrC%2FbpgIE7R8rAlnZExukjjjpE8Uavck12S8zvsF7CtV9pNYZwaa%2F0AyJoev0hvSJ5fyZhZRJlcD914kY7LXLOmEWBVSOG0ktmHUtiulnRlycCYZjU84jeWCjMkq4gatnQ7KPa2RDZoHRPEUsQ4UI2iqeELV7eDlwQHJ8z5hVF3fMV5A3aTbSDL7lFKlYJ5fWGnptBcs8BtkX6wWMnZPuT7RK5qmyOrvVOGS4%2BpMsgYjFUdhaOlkczBIn1D3bClV1pkoV92vUSV3LoEGheXZ%2FjyV5%2F8CoVd8TbUSAAA%3D).

            To run locally:
            - Install the [XMLUI CLI](https://github.com/xmlui-org/xmlui-cli/releases)
            - `xmlui run https://github.com/xmlui-org/xmlui-weather/releases/latest/download/xmlui-weather.zip`
