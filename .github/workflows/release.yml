name: Release Zip

on:
  push:
    tags:
      - "v*"
  workflow_dispatch:
    inputs:
      tag:
        description: "Tag name to release (e.g., v1.0.0)"
        required: true

permissions:
  contents: write

jobs:
  release:
    runs-on: ubuntu-latest
    env:
      TAG_NAME: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.tag || github.ref_name }}
    steps:
      - name: Check out code
        uses: actions/checkout@v4

      - name: Create zip archive with top-level folder
        run: |
          echo "=== Current directory ==="
          pwd
          echo "=== Listing files ==="
          ls -la
          echo "=== Creating xmlui-weather folder ==="
          mkdir -p xmlui-weather
          echo "=== Copying files ==="
          cp -v -r Main.xmlui components index.html README.md xmlui-weather/
          echo "=== Contents of xmlui-weather ==="
          ls -la xmlui-weather/
          echo "=== Creating zip ==="
          zip -r xmlui-weather.zip xmlui-weather
          echo "=== Zip created ==="
          ls -lh xmlui-weather.zip

      - name: Publish release assets
        uses: softprops/action-gh-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ env.TAG_NAME }}
          target_commitish: ${{ github.sha }}
          files: xmlui-weather.zip
          body: |
            You can run it [online](https://playground.xmlui.org/#/playground/#H4sIAAAAAAAAE71Y227bOBD9lSmRjVvUl6RogYVrpUidpl2g2S3qbvNQBwUjTixuJFIgKTupoX%2FqN%2FTLFqRulOLE8T5sniLyzO3MkDP0mmhDBaOxFEjGa0LTlIzJ5DhN5wJgSdUw5OY2mJMZFYbCZ6lpH6bHc1Jta6QqjKYPg1Apqc5Qa7rAYE6aDYNJ%2BrfgJpiT02aV6xOunML1FY015s1WKAXjhkthN2GF1ESoTqihwyWNMxyGmVIozPca9%2B3gAjx5gVShNt%2BpQnqPCh%2FSkabaKClkcnuPaLny7eCigZYqjubCaplY9ExmKkT7CcBZMCeepsIYQKbiYE4iY1I9Ho1WxqghF6N1Q3f%2B5kqqhJrgn8NKxtH8pzT8iofUBt%2BlHECKdxYUzMlTh34GwRGswU8QBNCbyixmIKSBKy5YFSkwaihcSQU9eA6NK%2FAcekP4FCPVCGGE4TWYCMFWDgia4LD3GsqcQgAupa8tJzCqWJl%2BnRkaXpefAJMPh0fFfwDnpfETqqNLSRUrISOHqfBOHpaoDA9pfBzzhUhQ2MIKURhULgOFwskXvDFv5U31XSbBuvuHSDNTcWX%2F0piGGMmYoeXsndXkxTUc%2BlguuOE0%2FmpLwRaIxeU%2BYMWZiYI5OXylMPE3pDjhbBpR4XL1dEnjMi%2FOVABLGvsMGpV5BJZBvc2MkaLRGdNLtCX0Hk1FoW8SBb2MkVV%2BDo3iydNnwxjFwkRwBAd528FpzMNr61zpmZf9wLn5%2Bk4RPZT10unPlHH5XsksvZ%2FG6o7IH8VYha5Yy73E13XirQBM%2FkrtWakJ%2B%2FXzdE5gWZo%2FbTm8GT%2F18NMOfjLqmJyMmqCP6lLulL%2BtUFhF6K45n9fcmVKcutJmqI3KQsOX6IXZEShNWJWNgeK8VRKVJf9G4%2BKTkguFWnvER1LxH1KYbSdslnIhUPmpdiE1rmu0VzRVt638fJSUcbFoXTj2lNXclVEUH91LY7o9qlhShgz29%2B%2Fe3nbxSauG7UJZwR4HlzS8XiiZCTaVsbtK90L7z6DZGLSjq90v%2FNvCIixoGszJQadwX7SK0G8ErWLzYY%2FjHGDtt7yhwoUt7%2F192LBsu9m9OyWPbx7efg69PvRgDL1e3rYcykwYdVtDW5F5md%2BQ%2Bx1bwM7wiswrKcyM%2F7An%2FaW7xN3KOfJFZCUvZcw6cgDr5k4KbG%2FtwRuo5xM3An2fwri7dJr%2F%2Btmy32Zgo0svCpe2Z9xzKt%2FVyF71%2F%2BAm7savMeGbOWiiqw4e6nBTpjc4cecOfbC0N%2FsaLzo%2BnSLGGmJ%2BjVsS5IAf%2BTW2k1Qv20RtYvNOyX64r2QfeasCTMpGPjPU%2BLFUrWgay4zBVC7bvR7q7uSlIbTY0ELz37o9a4uZD1nCGTe3W21EJXBnC%2Bd26pyliGyrjRUXTFvkGY9R55Ck0Y7GPtkmlyncaiotgTkkl%2B055n%2FI7SwTiuv7nKyfG0Nd4PIdSZhlQqN5jHaNZlflZ1I%2BzvmkBP4XA49xPylw%2BcPZm4zuvEfsUe7OFU82DxZPtk5RG6%2BtHUes4ilCm8cIGAkaEcoXcD1C1eWrN0yC7Ugno%2BPUzqSkT0KZpFKgMJqMv5HJtPp0puwB9fJROFUNN8X0sqdTGuLgcE4g4eK8fPj87vrTkcfpLle4trLrvVTJVA9d5vP2QFh3qk39qBIs%2Bo0n6M0Sk1EdqCOEXFgmxBVf2N9GTIQJWj7WhDMyJjdJnHHSJwq1e9BrMl7n%2FQL2lSr7Saw3A81%2FIBmTw1fpDemTS3kziyiTq4F7bZIx2WuWdEKsCimcNhLbOGrbldLOBDo4k4zGJ5zGckHGZBVxg9ZOB%2BUe5sgGzfOjeMhYB4oBNlU8oep28PLggOR5nzCqru8YL6BuTm4kmX2IqVIwzy%2BstHTaCxb4DbIvVgsZu4dgn%2BgVTVNk9XeqcMlxdSZZg5GKozC0dLI5GKRPqHv0lCrrTJSr7reskjuXQIPC8mx%2F3MrzfwFaBZKe8xIAAA%3D%3D).

            To run locally:
            - Install the [XMLUI CLI](https://github.com/xmlui-org/xmlui-cli/releases)
            - `xmlui run https://github.com/xmlui-org/xmlui-weather/releases/latest/download/xmlui-weather.zip`
